"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
"""
import asyncio
from llm_scripts import save_script, load_scripts, format_script_with_llm, get_all_scripts

async def test_scripts():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å–∫—Ä–∏–ø—Ç–æ–≤"""
    print("=" * 60)
    print("–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è LLM")
    print("=" * 60)
    print()
    
    # –¢–µ—Å—Ç 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
    print("üìù –¢–µ—Å—Ç 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞")
    test_script = "–ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –ø–∞—Ä–∫–æ–≤–∫—É, –≥–æ–≤–æ—Ä–∏ —á—Ç–æ –µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞ –Ω–∞ 50 –º–µ—Å—Ç —Ä—è–¥–æ–º —Å –∑–∞–ª–æ–º"
    success = save_script(test_script, admin_name="–¢–µ—Å—Ç–æ–≤—ã–π –∞–¥–º–∏–Ω")
    if success:
        print(f"‚úÖ –°–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {test_script[:50]}...")
    else:
        print("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞")
    print()
    
    # –¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
    print("üìö –¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤")
    scripts = load_scripts()
    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–≤: {len(scripts)} —Å–∏–º–≤–æ–ª–æ–≤")
    if scripts:
        print(f"–ü–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤: {scripts[:100]}...")
    print()
    
    # –¢–µ—Å—Ç 3: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ LLM
    print("ü§ñ –¢–µ—Å—Ç 3: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ LLM")
    raw_text = "–µ—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –ø–æ–¥–∞—Ä–∫–∏ –≥–æ–≤–æ—Ä–∏ —á—Ç–æ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã –¥–µ–Ω—å–≥–∏ –∏–ª–∏ –≤–∏–Ω–æ"
    print(f"–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç: {raw_text}")
    formatted = await format_script_with_llm(raw_text)
    if formatted:
        print(f"‚úÖ –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ: {formatted}")
    else:
        print("‚ö†Ô∏è LLM –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç")
    print()
    
    # –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    print("üìã –¢–µ—Å—Ç 4: –í—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã")
    all_scripts = get_all_scripts()
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–≤: {len(all_scripts)}")
    for i, script in enumerate(all_scripts, 1):
        print(f"  {i}. {script['meta']}")
        print(f"     {script['text'][:60]}...")
    print()
    
    print("‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!")

if __name__ == "__main__":
    asyncio.run(test_scripts())

